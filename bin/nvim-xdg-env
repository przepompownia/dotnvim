#!/usr/bin/env bash

configDir="$(dirname "$(dirname "$(realpath "${BASH_SOURCE[0]}")")")"

localXdgDir='.xdg2'

export XDG_CONFIG_HOME="${configDir}"
export XDG_DATA_HOME="${configDir}/${localXdgDir}/data"
export XDG_STATE_HOME="${configDir}/${localXdgDir}/state"
export XDG_CACHE_HOME="${configDir}/${localXdgDir}/cache"
nvimAppName="${NVIM_APPNAME:-nvim}"

mkdir -p "$XDG_CACHE_HOME/${nvimAppName}" "$XDG_STATE_HOME" "$XDG_DATA_HOME"

if [[ -z ${NVIM_BINARY:="$(command -pv nvim)"} || ! -x ${NVIM_BINARY} ]]; then
    echo 'Try to set NVIM_BINARY first' >&2
    exit 1
fi

"${NVIM_BINARY}" "$@"
